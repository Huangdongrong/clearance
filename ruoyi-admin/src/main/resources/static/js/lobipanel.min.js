Math.randomString=function(n){var text="";var possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<n;i++){text+=possible.charAt(Math.floor(Math.random()*possible.length))}return text};String.prototype.getCss=function(){var css={};var style=this.valueOf().split(";");for(var i=0;i<style.length;i++){style[i]=$.trim(style[i]);if(style[i]){var s=style[i].split(":");css[$.trim(s[0])]=$.trim(s[1])}}return css};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.toCamel=function(){return this.replace(/(\-[a-z])/g,function($1){return $1.toUpperCase().replace("-","")})};String.prototype.toDash=function(){return this.replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()})};String.prototype.toUnderscore=function(){return this.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase()})};Number.prototype.isBetween=function(num1,num2,including){if(!including){if(this.valueOf()<num2&&this.valueOf()>num1){return true}}else{if(this.valueOf()<=num2&&this.valueOf()>=num1){return true}}return false};$.fn.insertAt=function(i,selector){var $object=selector;if(typeof selector==="string"){$object=$(selector)}i=Math.min($object.children().length,i);if(i==0){$object.prepend(this);return this}var oldIndex=this.data("index");if(!i||isNaN(i)){i=$object.children().length-1}this.attr("data-index",i);var $el=$object.children().eq(i-1);if($el.length){$el.after(this)}else{$object.append(this)}$object.children().each(function(index,el){var $el=$(el);if(oldIndex<i&&index>oldIndex&&index<=i){$el.attr("data-index",parseInt($el.data("data-index"),10)-1)}else{if(oldIndex>=i&&index>i&&index<=oldIndex){$el.attr("data-index",parseInt($el.attr("data-index"),10)+1)}}});return this};$.fn.disableSelection=function(){return this.attr("unselectable","on").css("user-select","none").on("selectstart",false)};$.fn.enableSelection=function(){return this.removeAttr("unselectable").css("user-select","initial").off("selectstart")};$(function(){var STORAGE_PREFIX="lobipanel_";var StorageLocal=function(){this.saveChildPositions=function(parentInnerId,positions){if(positions!==undefined){localStorage.setItem(STORAGE_PREFIX+"parent_"+parentInnerId,JSON.stringify(positions))}};this.savePanelParams=function(innerId,storage){localStorage.setItem(STORAGE_PREFIX+innerId,JSON.stringify(storage))};this.getAllPanelPositions=function(){var parents=[];for(var i in localStorage){if(i.indexOf(STORAGE_PREFIX+"parent_")===0){var innerParentId=i.replace(STORAGE_PREFIX+"parent_","");var $parent=$(".lobipanel-parent-sortable[data-inner-id="+innerParentId+"]");if($parent.length){parents[innerParentId]=JSON.parse(localStorage[i])}}}return parents};this.getPanelStorage=function(innerId){var item=localStorage.getItem(STORAGE_PREFIX+innerId);return JSON.parse(item||null)||{}}};var LobiPanel=function($el,options){var me=this;this.hasRandomId=false;this.storage=null;this.$el=$el;if(!me.$el.data("inner-id")){me.hasRandomId=true;me.$el.attr("data-inner-id",Math.randomString(10))}this.innerId=me.$el.data("inner-id");this.$options=me._processInput(options);me.$heading=this.$el.find(">.panel-heading");me.$body=this.$el.find(">.panel-body");me._init();me.$el.css("display","none");me._applyState(me.$options.state,me.$options.stateParams);me.$el.css("display","block")};LobiPanel.prototype={_processInput:function(options){var me=this;if(!options){options={}}if(!me.hasRandomId){if(!this.storageObject){this.storageObject=new StorageLocal()}me.storage=(this&&this.storageObject)?this.storageObject.getPanelStorage(me.innerId):null}var opts=me._getOptionsFromAttributes();options=$.extend({},$.fn.lobiPanel.DEFAULTS,me.storage,options,opts);var objects=["unpin","reload","expand","minimize","close","editTitle"];for(var i=0;i<objects.length;i++){var prop=objects[i];if(typeof options[prop]==="object"){options[prop]=$.extend({},$.fn.lobiPanel.DEFAULTS[prop],options[prop],opts[prop])}}return options},_init:function(){var me=this;me.$el.addClass("lobipanel");me.$heading.append(me._generateControls());var parent=me.$el.parent();me._appendInnerIdToParent(parent,me.innerId);me._enableSorting();me._onToggleIconsBtnClick();me._enableResponsiveness();me._setBodyHeight();if(me.$options.autoload){me.load()}var maxWidth="calc(100% - "+me.$heading.find(".dropdown-menu").children().length*me.$heading.find(".dropdown-menu li").first().outerWidth()+"px)";me.$heading.find(".panel-title").css("max-width",maxWidth);if(me.getParam("panelTitle")){me.$heading.find(".panel-title").html(me.getParam("panelTitle"))}var style=me.getParam("panelStyle");if(style){me.applyStyle(style.bg,style.text)}me._triggerEvent("init")},isPanelInit:function(){var me=this;return me.$el.hasClass("lobipanel")&&me.$el.data("inner-id")},isPinned:function(){var me=this;return !me.$el.hasClass("panel-unpin")},pin:function(){var me=this;me.disableResize();me.disableDrag();me._offPanelClick();me.$el.removeClass("panel-unpin").attr("old-style",me.$el.attr("style")).css("position","relative");
var toRemoveProperties=["position","z-index","left","top","width","height"];for(var i in toRemoveProperties){me.$el.css(toRemoveProperties[i],"")}me.$body.css({width:"",height:""});me._setBodyHeight();me._insertInParent();me._enableSorting();return me},unpin:function(){var me=this;if(me.$el.hasClass("panel-collapsed")){return me}me._disableSorting();if(me.$el.attr("old-style")){me.$el.attr("style",me.$el.attr("old-style"))}else{var width=me.$el.width();var height=me.$el.height();var left=Math.max(0,(($(window).width()-me.$el.outerWidth())/2));var top=Math.max(0,($(document).scrollTop()+($(window).height()-me.$el.outerHeight())/2));me.$el.css({left:left,top:top,width:width,height:height})}var res=me._getMaxZIndex();me.$el.css("z-index",res["z-index"]+1);me._onPanelClick();me.$el.addClass("panel-unpin");$("body").append(me.$el);var panelWidth=me._getAvailableWidth(me.$el.width());var panelHeight=me._getAvailableHeight(me.$el.height());me.$el.css({position:"absolute",width:panelWidth,height:panelHeight});var bHeight=me._calculateBodyHeight(panelHeight);var bWidth=me._calculateBodyWidth(panelWidth);me.$body.css({width:bWidth,height:bHeight});if(me.$options.draggable){me.enableDrag()}if(me.$options.resize!=="none"){me.enableResize()}return me},togglePin:function(){var me=this;if(this.isPinned()){this.unpin()}else{this.pin()}return me},isMinimized:function(){var me=this;return me.$el.hasClass("panel-minimized")||me.$el.hasClass("panel-collapsed")},minimize:function(){var me=this;me._triggerEvent("beforeMinimize");if(me.isMinimized()){return me}if(me.isPinned()){me.$body.slideUp();me.$el.find(".panel-footer").slideUp();me.$el.addClass("panel-collapsed");me._saveState("collapsed");me._changeClassOfControl(me.$heading.find('[data-func="minimize"]'))}else{me.disableTooltips();var footer=me._getFooterForMinimizedPanels();var children=footer.find(">*");var left,top;top=footer.offset().top;if(children.length===0){left=footer.offset().left}else{var ch=$(children[children.length-1]);left=ch.offset().left+ch.width()}if(!me.$el.hasClass("panel-expanded")){me.$el.attr("old-style",me.$el.attr("style"))}me.$el.animate({left:left,top:top,width:200,height:footer.height()},100,function(){if(me.$el.hasClass("panel-expanded")){me.$el.removeClass("panel-expanded");me.$el.find(".panel-heading [data-func=expand] ."+LobiPanel.PRIVATE_OPTIONS.iconClass).removeClass(me.$options.expand.icon2).addClass(me.$options.expand.icon)}me.$el.addClass("panel-minimized");me.$el.removeAttr("style");me.disableDrag();me.disableResize();me._expandOnHeaderClick();footer.append(me.$el);$("body").addClass("lobipanel-minimized");var maxWidth="calc(100% - "+me.$heading.find(".dropdown-menu li>a:visible").length*me.$heading.find(".dropdown-menu li>a:visible").first().outerWidth()+"px)";me.$heading.find(".panel-title").css("max-width",maxWidth);me._saveState("minimized");me._triggerEvent("onMinimize")})}return me},maximize:function(){var me=this;me._triggerEvent("beforeMaximize");if(!me.isMinimized()){return me}if(me.isPinned()){me.$body.slideDown();me.$el.find(".panel-footer").slideDown();me.$el.removeClass("panel-collapsed");me._saveState("pinned");me._changeClassOfControl(me.$heading.find('[data-func="minimize"]'))}else{me.enableTooltips();var css=me.$el.attr("old-style").getCss();me.$el.css({position:css.position||"fixed","z-index":css["z-index"],left:me.$el.offset().left,top:me.$el.offset().top,width:me.$el.width(),height:me.$el.height()});$("body").append(me.$el);delete css["position"];delete css["z-index"];me.$el.animate(css,100,function(){me.$el.css("position","");me.$el.removeClass("panel-minimized");me.$el.removeAttr("old-style");if(me.$options.draggable){me.enableDrag()}me.enableResize();me._removeExpandOnHeaderClick();var footer=me._getFooterForMinimizedPanels();if(footer.children().length===0){footer.remove()}$("body").removeClass("lobipanel-minimized").addClass("lobipanel-minimized");var maxWidth="calc(100% - "+me.$heading.find(".dropdown-menu li").length*me.$heading.find(".dropdown-menu li").first().outerWidth()+"px)";me.$heading.find(".panel-title").css("max-width",maxWidth);me._updateUnpinnedState();me._triggerEvent("onMaximize")})}return me},toggleMinimize:function(){var me=this;if(me.isMinimized()){me.maximize()}else{me.minimize()}return me},isOnFullScreen:function(){var me=this;return me.$el.hasClass("panel-expanded")},toFullScreen:function(){var me=this;me._triggerEvent("beforeFullScreen");if(me.$el.hasClass("panel-collapsed")){return me}me.$el.attr("data-index",me.$el.index());me._changeClassOfControl(me.$heading.find('[data-func="expand"]'));me.$el.css("position","fixed");var res=me._getMaxZIndex();if(me.isPinned()||me.isMinimized()){me.enableTooltips();me.$el.css({"z-index":res["z-index"]+1,left:me.$el.offset().left,top:me.$el.offset().top-$(window).scrollTop(),width:me.$el.width(),height:me.$el.height()});$("body").append(me.$el);var footer=me._getFooterForMinimizedPanels();if(footer.children().length===0){footer.remove()}}else{me.$body.css({width:"",height:""});
me._setBodyHeight()}if(!me.isMinimized()){me.$el.attr("old-style",me.$el.attr("style"));me.disableResize()}else{me.$el.removeClass("panel-minimized");me._removeExpandOnHeaderClick()}var toolbar=$("."+LobiPanel.PRIVATE_OPTIONS.toolbarClass);var toolbarHeight=toolbar.outerHeight()||0;me.$el.animate({width:$(window).width(),height:$(window).height()-toolbarHeight,left:0,top:0},me.$options.expandAnimation,function(){me.$el.css({width:"",height:"",right:0,bottom:toolbarHeight});me.$el.addClass("panel-expanded");$("body").css("overflow","hidden");me.$body.css({width:me._calculateBodyWidth(me.$el.width()),height:me._calculateBodyHeight(me.$el.height())});me.disableDrag();if(me.isPinned()){me._disableSorting()}me._saveState("fullscreen");me._triggerEvent("onFullScreen")});return me},toSmallSize:function(){var me=this;me._triggerEvent("beforeSmallSize");me._changeClassOfControl(me.$heading.find('[data-func="expand"]'));var css=me.$el.attr("old-style").getCss();var toRemoveProperties=["position","z-index","left","top","width","height"];me.$el.animate({position:"absolute",left:css.left,top:css.top,width:css.width,height:css.height,right:css.right,bottom:css.bottom},me.$options.collapseAnimation,function(){me.$el.removeAttr("old-style");if(!me.$el.hasClass("panel-unpin")){for(var i in toRemoveProperties){me.$el.css(toRemoveProperties[i],"")}me._insertInParent();me._enableSorting()}else{if(me.$options.draggable){me.enableDrag()}me.enableResize()}me.$el.removeClass("panel-expanded");$("body").css("overflow","auto");var bWidth="";var bHeight="";if(!me.isPinned()){bWidth=me._calculateBodyWidth(me.getWidth());bHeight=me._calculateBodyHeight(me.getHeight())}else{if(me.$options.bodyHeight!=="auto"){bHeight=me.$options.bodyHeight}}if(me.isPinned()){me._saveState("pinned")}else{me._updateUnpinnedState()}me.$body.css({width:bWidth,height:bHeight});me._triggerEvent("onSmallSize")});return me},toggleSize:function(){var me=this;if(me.isOnFullScreen()){me.toSmallSize()}else{me.toFullScreen()}return me},close:function(animationDuration){var me=this,animationDuration=animationDuration===undefined?100:animationDuration;me._triggerEvent("beforeClose");me.$el.hide(animationDuration,function(){if(me.isOnFullScreen()){$("body").css("overflow","auto")}me._triggerEvent("onClose");me.$el.remove();var footer=me._getFooterForMinimizedPanels();if(footer.children().length===0){footer.remove()}});return me},setPosition:function(left,top,animationDuration){var me=this,animationDuration=animationDuration===undefined?100:animationDuration;if(me.isPinned()){return me}me.$el.animate({"left":left,"top":top},animationDuration);return me},setWidth:function(w,animationDuration){var me=this,animationDuration=animationDuration===undefined?100:animationDuration;if(me.isPinned()){return me}var bWidth=me._calculateBodyWidth(w);me.$el.animate({width:w},animationDuration);me.$body.animate({width:bWidth},animationDuration);return me},setHeight:function(h,animationDuration){var me=this,animationDuration=animationDuration===undefined?100:animationDuration;if(me.isPinned()){return me}var bHeight=me._calculateBodyHeight(h);me.$el.animate({height:h},animationDuration);me.$body.animate({height:bHeight},animationDuration);return me},setSize:function(w,h,animationDuration){var me=this,animationDuration=animationDuration===undefined?100:animationDuration;if(me.isPinned()){return me}var bHeight=me._calculateBodyHeight(h);var bWidth=me._calculateBodyWidth(w);me.$el.animate({height:h,width:w},animationDuration);me.$body.animate({height:bHeight,width:bWidth},animationDuration);return me},getPosition:function(){var me=this;var offset=me.$el.offset();return{x:offset.left,y:offset.top}},getWidth:function(){var me=this;return me.$el.width()},getHeight:function(){var me=this;return me.$el.height()},bringToFront:function(){var me=this;me._triggerEvent("beforeToFront");var res=me._getMaxZIndex();if(res["id"]===me.$el.data("inner-id")){return me}me.$el.css("z-index",res["z-index"]+1);me._triggerEvent("onToFront");return me},enableDrag:function(){var me=this;me.$el.draggable({handle:".panel-heading",containment:me.$options.constrain,start:function(){me.$el.css("position","absolute")},stop:function(){me.$el.css("position","");me._updateUnpinnedState()}});return me},disableDrag:function(){var me=this;if(me.$el.hasClass("ui-draggable")){me.$el.draggable("destroy")}return me},enableResize:function(){var me=this;var handles=false;if(me.$options.resize==="vertical"){handles="n, s"}else{if(me.$options.resize==="horizontal"){handles="e, w"}else{if(me.$options.resize==="both"){handles="all"}}}if(!handles){return me}me.$el.resizable({minWidth:me.$options.minWidth,maxWidth:me.$options.maxWidth,minHeight:me.$options.minHeight,maxHeight:me.$options.maxHeight,handles:handles,start:function(){me.$el.disableSelection();me._triggerEvent("resizeStart")},stop:function(){me.$el.enableSelection();me._triggerEvent("resizeStop")},resize:function(){var bHeight=me._calculateBodyHeight(me.$el.height());var bWidth=me._calculateBodyWidth(me.$el.width());
me.$body.css({width:bWidth,height:bHeight});me._updateUnpinnedState();me._triggerEvent("onResize")}});return me},disableResize:function(){var me=this;if(me.$el.hasClass("ui-resizable")){me.$el.resizable("destroy")}return me},startLoading:function(){var me=this;var spinner=me._generateWindow8Spinner();me.$el.append(spinner);var sp=spinner.find(".spinner");sp.css("margin-top",50);return me},stopLoading:function(){var me=this;me.$el.find(".spinner-wrapper").remove();return me},setLoadUrl:function(url){var me=this;me.$options.loadUrl=url;return me},load:function(params){var me=this;params=params||{};if(typeof params==="string"){params={url:params}}var url=params.url||me.$options.loadUrl,data=params.data||{},callback=params.callback||null;if(!url){return me}me._triggerEvent("beforeLoad");me.startLoading();me.$body.load(url,data,function(result,status,xhr){if(callback&&typeof callback==="function"){me.callback(result,status,xhr)}me.stopLoading();me._triggerEvent("loaded",result,status,xhr)});return me},destroy:function(){var me=this;me.disableDrag();me.disableResize();me.$options.sortable=false;me._enableSorting();me._removeInnerIdFromParent(me.innerId);me.$el.removeClass("lobipanel").removeAttr("data-inner-id").removeAttr("data-index").removeData("lobiPanel");me.$heading.find(".dropdown").remove();return me.$el},startTitleEditing:function(){var me=this;var title=me.$heading.find(".panel-title").text().trim();var input=$('<input value="'+title+'"/>');input.on("keydown",function(ev){if(ev.which===13){me.finishTitleEditing()}else{if(ev.which===27){me.cancelTitleEditing()}}});me.$heading.find(".panel-title").data("old-title",title).html("").append(input);input[0].focus();input[0].select();me._changeClassOfControl(me.$heading.find('[data-func="editTitle"]'));return me},isTitleEditing:function(){var me=this;return me.$heading.find(".panel-title input").length>0},cancelTitleEditing:function(){var me=this;var title=me.$heading.find(".panel-title");title.html(title.data("old-title")).find("input").remove();me._changeClassOfControl(me.$heading.find('[data-func="editTitle"]'));return me},finishTitleEditing:function(){var me=this,input=me.$heading.find("input");if(me._triggerEvent("beforeTitleChange",input.val())===false){return me}me.saveParam("panelTitle",input.val());me.$heading.find(".panel-title").html(input.val());input.remove();me._changeClassOfControl(me.$heading.find('[data-func="editTitle"]'));me._triggerEvent("onTitleChange",input.val());return me},enableTooltips:function(){var me=this;if($(window).width()<768){return me}var controls=me.$heading.find(".dropdown-menu>li>a");controls.each(function(index,el){var $el=$(el);$el.attr("data-toggle","tooltip").attr("data-title",$el.data("tooltip")).attr("data-placement","bottom")});controls.each(function(ind,el){$(el).tooltip({container:"body",template:'<div class="tooltip lobipanel-tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})});return me},disableTooltips:function(){var me=this;var $links=me.$heading.find(".dropdown-menu>li>a");$links.each(function(ind,el){var bsTooltip=$(el).data("bs.tooltip");if(bsTooltip){$(el).tooltip("destroy")}});return me},_generateControls:function(){var me=this;var dropdown=me._generateDropdown();var menu=dropdown.find(".dropdown-menu");if(me.$options.editTitle!==false){menu.append(me._generateEditTitle())}if(me.$options.unpin!==false){menu.append(me._generateUnpin())}if(me.$options.reload!==false){menu.append(me._generateReload())}if(me.$options.minimize!==false){menu.append(me._generateMinimize())}if(me.$options.expand!==false){menu.append(me._generateExpand())}if(me.$options.changeStyle!==false){menu.append(me._generateChangeStyle())}if(me.$options.close!==false){menu.append(me._generateClose())}menu.find(">li>a").on("click",function(ev){ev.preventDefault();ev.stopPropagation()});return dropdown},_generateDropdown:function(){var me=this;return $('<div class="dropdown"></div>').append('<ul class="dropdown-menu dropdown-menu-right"></ul>').append('<div class="dropdown-toggle" data-toggle="dropdown"><span class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+me.$options.toggleIcon+'"></div>')},_generateEditTitle:function(){var me=this;var options=me.$options.editTitle;var control=$('<a data-func="editTitle"></a>');control.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+options.icon+'"></i>');if(options.tooltip&&typeof options.tooltip==="string"){control.append('<span class="control-title">'+options.tooltip+"</span>");control.attr("data-tooltip",options.tooltip)}me._attachEditTitleClickListener(control);return $("<li></li>").append(control)},_attachEditTitleClickListener:function(control){var me=this;control.on("mousedown",function(ev){ev.stopPropagation()});control.on("click",function(ev){ev.stopPropagation();me.hideTooltip(control);if(me.isTitleEditing()){me.finishTitleEditing()}else{me.startTitleEditing()}})},hideTooltip:function($el){var bsTooltip=$el.data("bs.tooltip");if(bsTooltip){$el.tooltip("hide")
}return this},_generateUnpin:function(){var me=this;var options=me.$options.unpin;var control=$('<a data-func="unpin"></a>');control.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+options.icon+'"></i>');if(options.tooltip&&typeof options.tooltip==="string"){control.append('<span class="control-title">'+options.tooltip+"</span>");control.attr("data-tooltip",options.tooltip)}me._attachUnpinClickListener(control);return $("<li></li>").append(control)},_attachUnpinClickListener:function(control){var me=this;control.on("mousedown",function(ev){ev.stopPropagation()});control.on("click",function(){me.hideTooltip(control);me.doTogglePin()})},_generateReload:function(){var me=this;var options=me.$options.reload;var control=$('<a data-func="reload"></a>');control.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+options.icon+'"></i>');if(options.tooltip&&typeof options.tooltip==="string"){control.append('<span class="control-title">'+options.tooltip+"</span>");control.attr("data-tooltip",options.tooltip)}me._attachReloadClickListener(control);return $("<li></li>").append(control)},_attachReloadClickListener:function(control){var me=this;control.on("mousedown",function(ev){ev.stopPropagation()});control.on("click",function(){me.hideTooltip(control);me.load()})},_generateMinimize:function(){var me=this;var options=me.$options.minimize;var control=$('<a data-func="minimize"></a>');control.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+options.icon+'"></i>');if(options.tooltip&&typeof options.tooltip==="string"){control.append('<span class="control-title">'+options.tooltip+"</span>");control.attr("data-tooltip",options.tooltip)}me._attachMinimizeClickListener(control);return $("<li></li>").append(control)},_attachMinimizeClickListener:function(control){var me=this;control.on("mousedown",function(ev){ev.stopPropagation()});control.on("click",function(ev){ev.stopPropagation();me.hideTooltip(control);me.toggleMinimize()})},_generateExpand:function(){var me=this;var options=me.$options.expand;var control=$('<a data-func="expand"></a>');control.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+options.icon+'"></i>');if(options.tooltip&&typeof options.tooltip==="string"){control.append('<span class="control-title">'+options.tooltip+"</span>");control.attr("data-tooltip",options.tooltip)}me._attachExpandClickListener(control);return $("<li></li>").append(control)},_generateChangeStyle:function(){var me=this;var options=me.$options.changeStyle;var $control=$('<a data-func="changeStyle"></a>');$control.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+options.icon+'"></i>');if(options.tooltip&&typeof options.tooltip==="string"){$control.append('<span class="control-title">'+options.tooltip+"</span>");$control.attr("data-tooltip",options.tooltip)}var $dropdown=$('<li class="style-change-item"></li>').append($control);var $menu=$("<div>",{"class":"style-list"}).appendTo($dropdown);if(me.$options.styles){for(var i=0;i<me.$options.styles.length;i++){var style=me.$options.styles[i];$menu.append('<div class="style-item style-primary" style="background-color: '+style.bg+'" data-bg="'+style.bg+'" data-text="'+style.text+'"></div>')}}$menu.find(".style-item").on("click",function(){var $item=$(this);me.saveParam("panelStyle",{bg:$item.data("bg"),text:$item.data("text")});me.applyStyle($item.data("bg"),$item.data("text"));$menu.removeClass("opened")});$control.on("click",function(){var $this=$(this);var $parent=$this.closest(".style-change-item");$parent.find(".style-list").toggleClass("opened")});return $dropdown},applyStyle:function(color,text){var me=this;me.$heading.css("background-color",color);me.$heading.css("border-color",color);me.$heading.css("color",text);me.$el.css("border-color",color)},_createDropdownForStyleChange:function(){var me=this;var $dropdown=$("<div>",{"class":"dropdown"}).append($("<button>",{"type":"button","data-toggle":"dropdown","class":"btn btn-default btn-xs","html":'<i class="glyphicon glyphicon-th"></i>'}));var $menu=$("<div>",{"class":"dropdown-menu dropdown-menu-right"}).appendTo($dropdown);for(var i=0;i<0;i++){var st=me.$globalOptions.listStyles[i];var st="primary";$('<div class="'+st+'"></div>').on("mousedown",function(ev){ev.stopPropagation()}).click(function(){var classes=me.$el[0].className.split(" ");var oldClass=null;for(var i=0;i<classes.length;i++){if(me.$globalOptions.listStyles.indexOf(classes[i])>-1){oldClass=classes[i]}}me.$el.removeClass(me.$globalOptions.listStyles.join(" ")).addClass(this.className);me._triggerEvent("styleChange",[me,oldClass,this.className])}).appendTo($menu)}return $dropdown},_attachExpandClickListener:function(control){var me=this;control.on("mousedown",function(ev){ev.stopPropagation()});control.on("click",function(ev){ev.stopPropagation();me.hideTooltip(control);me.toggleSize()})},_generateClose:function(){var me=this;var options=me.$options.close;var control=$('<a data-func="close"></a>');control.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+options.icon+'"></i>');
if(options.tooltip&&typeof options.tooltip==="string"){control.append('<span class="control-title">'+options.tooltip+"</span>");control.attr("data-tooltip",options.tooltip)}me._attachCloseClickListener(control);return $("<li></li>").append(control)},_attachCloseClickListener:function(control){var me=this;control.on("mousedown",function(ev){ev.stopPropagation()});control.on("click",function(ev){ev.stopPropagation();me.hideTooltip(control);me.close()})},_getMaxZIndex:function(){var me=this;var panels=$(".lobipanel.panel-unpin:not(.panel-minimized.panel-expanded)"),style,max,cur;if(panels.length===0){return{"id":"","z-index":LobiPanel.PRIVATE_OPTIONS.initialZIndex}}style=$(panels[0]).attr("style");var id=$(panels[0]).data("inner-id");if(!style){max=LobiPanel.PRIVATE_OPTIONS.initialZIndex}else{max=style.getCss()["z-index"]}for(var i=1;i<panels.length;i++){style=$(panels[i]).attr("style");if(!style){cur=0}else{cur=style.getCss()["z-index"]}if(cur>max){id=$(panels[i]).data("inner-id");max=cur}}return{"id":id,"z-index":parseInt(max,10)}},_onPanelClick:function(){var me=this;me.$el.on("mousedown.lobiPanel",function(){if(me.isPinned()||me.isMinimized()||me.isOnFullScreen()){return false}me.bringToFront()})},_offPanelClick:function(){var me=this;me.$el.off("mousedown.lobiPanel")},_changeClassOfControl:function(el){var me=this;el=$(el);var opts=me.$options[el.attr("data-func")];if(!opts.icon){return}el.find("."+LobiPanel.PRIVATE_OPTIONS.iconClass).toggleClass(opts.icon).toggleClass(opts.icon2)},_getFooterForMinimizedPanels:function(){var me=this;var minimizedCtr=$("."+LobiPanel.PRIVATE_OPTIONS.toolbarClass);if(minimizedCtr.length===0){minimizedCtr=$('<div class="'+LobiPanel.PRIVATE_OPTIONS.toolbarClass+'"></div>');$("body").append(minimizedCtr)}return minimizedCtr},_expandOnHeaderClick:function(){var me=this;me.$heading.on("click.lobiPanel",function(){me.maximize();me.bringToFront()})},_removeExpandOnHeaderClick:function(){var me=this;me.$heading.off("click.lobiPanel")},_getAvailableWidth:function(calcWidth){var me=this;if(me.$options.maxWidth){calcWidth=Math.min(calcWidth,me.$options.maxWidth)}if(me.$options.minWidth){calcWidth=Math.max(calcWidth,me.$options.minWidth)}return calcWidth},_getAvailableHeight:function(calcHeight){var me=this;if(me.$options.maxHeight){calcHeight=Math.min(calcHeight,me.$options.maxHeight)}if(me.$options.minHeight){calcHeight=Math.max(calcHeight,me.$options.minHeight)}return calcHeight},_calculateBodyHeight:function(h){var me=this;return h-me.$heading.outerHeight()-me.$el.find(".panel-footer").outerHeight()},_calculateBodyWidth:function(w){var me=this;return w-2},_appendInnerIdToParent:function(parent,innerId){var me=this;if(parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr)===undefined){parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr,innerId)}else{if(parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr).indexOf(innerId)>-1){return}var innerIds=parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr);parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr,innerIds+" "+innerId)}me.$el.attr("data-index",me.$el.index())},_insertInParent:function(){var me=this;var parent=$("["+LobiPanel.PRIVATE_OPTIONS.parentAttr+"~="+me.innerId+"]");me.$el.insertAt(me.$el.attr("data-index"),parent)},_generateWindow8Spinner:function(){var me=this;var template=['<div class="spinner spinner-windows8">','<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>","</div>"].join("");return $('<div class="spinner-wrapper">'+template+"</div>")},_enableSorting:function(){var me=this;var parent=me.$el.parent();if(parent.hasClass("ui-sortable")){parent.sortable("destroy")}if(me.$options.sortable){me.$el.addClass("lobipanel-sortable");parent.addClass("lobipanel-parent-sortable")}else{me.$el.removeClass("lobipanel-sortable")}parent.sortable({connectWith:".lobipanel-parent-sortable",items:".lobipanel-sortable",handle:".panel-heading",cursor:"move",placeholder:"lobipanel-placeholder",forcePlaceholderSize:true,opacity:0.7,revert:300,update:function(event,ui){me.savepanelPositions();var $panel=ui.item;var innerId=$panel.data("inner-id");me._removeInnerIdFromParent(innerId);me._appendInnerIdToParent(ui.item.parent(),innerId);me._triggerEvent("dragged")}})},savepanelPositions:function(){var me=this;var $parents=$(".lobipanel-parent-sortable");$parents.each(function(index,parent){var $parent=$(parent);var parentInnerId=$parent.data("inner-id");if(!parentInnerId){console.error("Panel does not have parent id ",$parent);return}var $childPanels=$parent.find(".lobipanel");var positions={};$childPanels.each(function(index,el){var $el=$(el);positions[$el.data("inner-id")]=index});if(me&&me.storageObject){me.storageObject.saveChildPositions(parentInnerId,positions)}})},_disableSorting:function(){var me=this;
var parent=me.$el.parent();if(parent.hasClass("ui-sortable")){parent.sortable("destroy")}},_removeInnerIdFromParent:function(innerId){var me=this;var parent=$("["+LobiPanel.PRIVATE_OPTIONS.parentAttr+"~="+innerId+"]");if(parent.length){var innerIds=parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr).replace(innerId,"").trim().replace(/\s{2,}/g," ");parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr,innerIds)}},_onToggleIconsBtnClick:function(){var me=this;me.$heading.find(".toggle-controls").on("click.lobiPanel",function(){me.$el.toggleClass("controls-expanded")})},_adjustForScreenSize:function(){var me=this;me.disableTooltips();if($(window).width()>768&&me.$options.tooltips){me.enableTooltips()}if(me.isOnFullScreen()){me.$body.css({width:me._calculateBodyWidth(me.$el.width()),height:me._calculateBodyHeight(me.$el.height())})}},_enableResponsiveness:function(){var me=this;me._adjustForScreenSize();$(window).on("resize.lobiPanel",function(){me._adjustForScreenSize()})},_setBodyHeight:function(){var me=this;if(me.$options.bodyHeight!=="auto"){me.$body.css({"height":me.$options.bodyHeight,overflow:"auto"})}},_getOptionsFromAttributes:function(){var me=this;var $el=me.$el;var options={};for(var key in $.fn.lobiPanel.DEFAULTS){var k=key.toDash();var val=$el.data(k);if(val!==undefined){if(typeof $.fn.lobiPanel.DEFAULTS[key]!=="object"){options[key]=val}else{options[key]=eval("("+val+")")}}}return options},_saveState:function(state,params){var me=this;if(!me.hasRandomId&&me.$options.stateful){if(me&&me.storage){me.storage.state=state;if(params){me.storage.stateParams=params}me._saveLocalStorage(me.storage)}}},getParam:function(key,value){var me=this;return(me&&me.storage)?me.storage[key]:""},saveParam:function(key,value){var me=this;if(me&&me.storage){me.storage[key]=value;me._saveLocalStorage(me.storage)}},_saveLocalStorage:function(storage){var me=this;if(me&&me.storageObject){me.storageObject.savePanelParams(me.innerId,storage)}},_applyState:function(state,params){var me=this;switch(state){case"pinned":if(me&&me.storageObject){var allPanelPositions=me.storageObject.getAllPanelPositions();for(var i in allPanelPositions){var panelPositions=allPanelPositions[i];var innerParentId=i;var $parent=$(".lobipanel-parent-sortable[data-inner-id="+innerParentId+"]");for(var j in panelPositions){var $panel=$("[data-inner-id="+j+"]");me._removeInnerIdFromParent($panel.data("inner-id"));me._appendInnerIdToParent($parent,$panel.data("inner-id"));if(!$panel.hasClass("panel-unpin")&&!$panel.hasClass("panel-expanded")){$panel.insertAt(panelPositions[j],$parent)}}}}break;case"unpinned":me.unpin();me.setPosition(params.left,params.top,0);me.setSize(params.width,params.height,0);break;case"minimized":me.unpin();me.minimize();break;case"collapsed":me.minimize();break;case"fullscreen":me.toFullScreen();break;default:break}},_applyIndex:function(index){var me=this;if(index!==null){me.$el.insertAt(index,me.$el.parent())}},_triggerEvent:function(eventType){var me=this;var args=Array.prototype.slice.call(arguments,1);args.unshift(me);me.$el.trigger(eventType+".lobiPanel",args);if(me.$options[eventType]&&typeof me.$options[eventType]==="function"){return me.$options[eventType].apply(me,args)}return true},doPin:function(){var me=this;if(me._triggerEvent("beforePin")!==false){me.pin();me._saveState("pinned");me._triggerEvent("onPin")}return me},doUnpin:function(){var me=this;if(me._triggerEvent("beforeUnpin")!==false){me.unpin();me._updateUnpinnedState();me._triggerEvent("onUnpin")}return me},doTogglePin:function(){var me=this;if(this.isPinned()){this.doUnpin()}else{this.doPin()}return me},_updateUnpinnedState:function(){var me=this;me._saveState("unpinned",me.getAlignment())},getAlignment:function(){var me=this;return{top:me.$el.css("top"),left:me.$el.css("left"),width:me.$el.css("width"),height:me.$el.css("height")}}};$.fn.lobiPanel=function(option){var args=arguments,ret=null;this.each(function(){var $this=$(this);var data=$this.data("lobiPanel");var options=typeof option==="object"&&option;if(!data){$this.data("lobiPanel",(data=new LobiPanel($this,options)))}if(typeof option==="string"){args=Array.prototype.slice.call(args,1);ret=data[option].apply(data,args)}});return ret};LobiPanel.PRIVATE_OPTIONS={parentAttr:"data-lobipanel-child-inner-id",toolbarClass:"lobipanel-minimized-toolbar",initialZIndex:10000,iconClass:"panel-control-icon"};$.fn.lobiPanel.DEFAULTS={draggable:true,sortable:false,connectWith:".ui-sortable",resize:"both",minWidth:200,minHeight:100,maxWidth:1200,maxHeight:700,loadUrl:"",autoload:true,bodyHeight:"auto",tooltips:true,toggleIcon:"glyphicon glyphicon-cog",expandAnimation:100,collapseAnimation:100,state:"pinned",initialIndex:null,stateful:false,constrain:"document",unpin:{icon:"glyphicon glyphicon-move",tooltip:"Unpin"},reload:{icon:"glyphicon glyphicon-refresh",tooltip:"Reload"},minimize:{icon:"glyphicon glyphicon-minus",icon2:"glyphicon glyphicon-plus",tooltip:"Minimize"},expand:{icon:"glyphicon glyphicon-resize-full",icon2:"glyphicon glyphicon-resize-small",tooltip:"Fullscreen"},changeStyle:{icon:"glyphicon glyphicon-th",tooltip:"Style"},close:{icon:"glyphicon glyphicon-remove",tooltip:"Close"},editTitle:{icon:"glyphicon glyphicon-pencil",icon2:"glyphicon glyphicon-floppy-disk",tooltip:"Edit title"},styles:[{bg:"#d9534f",text:"#FFF"},{bg:"#f0ad4e",text:"#FFF"},{bg:"#337ab7",text:"#FFF"},{bg:"#5bc0de",text:"#FFF"},{bg:"#4753e4",text:"#FFF"},{bg:"#9e4aea",text:"#FFF"}],storageObject:null,beforeTitleChange:null};
$(".lobipanel").lobiPanel();var $parent=$(".lobipanel-parent-sortable");if(!$parent.hasClass("ui-sortable")){$parent.sortable({connectWith:".lobipanel-parent-sortable",items:".lobipanel-sortable",handle:".panel-heading",cursor:"move",placeholder:"lobipanel-placeholder",forcePlaceholderSize:true,opacity:0.7,revert:300,update:function(event,ui){console.log(ui)}})}});